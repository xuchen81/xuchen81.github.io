$(function(){var a=new URLSearchParams(window.location.search),b=parseInt(a.get("l"))||1,c=1e3,e=50,f=2,g="#9c6017",h="#693f0c",k=150,l=10,m=12,n=15,o=m*e,p=[{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:4,y:8},{x:4,y:9},{x:4,y:10},{x:5,y:10},{x:6,y:10},{x:7,y:10},{x:8,y:10},{x:9,y:10},{x:9,y:9},{x:9,y:8},{x:9,y:7},{x:9,y:6},{x:9,y:5},{x:5,y:5},{x:6,y:5},{x:7,y:5},{x:8,y:5}],q=[p.concat([{x:6,y:8}]),p.concat([{x:6,y:8}]),p.concat([{x:7,y:8}]),p.concat([{x:7,y:8}]),[{x:3,y:4},{x:4,y:4},{x:5,y:4},{x:6,y:4},{x:7,y:4},{x:3,y:5},{x:3,y:6},{x:3,y:7},{x:4,y:7},{x:4,y:8},{x:4,y:9},{x:4,y:10},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:8,y:10},{x:8,y:9},{x:9,y:9},{x:10,y:9},{x:10,y:8},{x:10,y:7},{x:10,y:6},{x:9,y:6},{x:8,y:6},{x:8,y:5},{x:7,y:5}],[{x:2,y:4},{x:3,y:4},{x:4,y:4},{x:5,y:4},{x:6,y:4},{x:2,y:5},{x:2,y:6},{x:2,y:7},{x:2,y:8},{x:3,y:8},{x:4,y:8},{x:3,y:9},{x:4,y:9},{x:3,y:10},{x:3,y:11},{x:3,y:12},{x:4,y:12},{x:5,y:12},{x:6,y:12},{x:7,y:12},{x:7,y:11},{x:7,y:10},{x:8,y:11},{x:9,y:11},{x:10,y:11},{x:10,y:10},{x:10,y:9},{x:10,y:8},{x:10,y:7},{x:10,y:6},{x:9,y:6},{x:8,y:6},{x:8,y:7},{x:8,y:8},{x:7,y:8},{x:6,y:8},{x:6,y:7},{x:6,y:6},{x:6,y:5}],[{x:3,y:5},{x:3,y:6},{x:3,y:7},{x:2,y:7},{x:2,y:8},{x:2,y:9},{x:2,y:10},{x:3,y:10},{x:3,y:11},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:10,y:11},{x:10,y:10},{x:10,y:9},{x:11,y:9},{x:11,y:8},{x:11,y:7},{x:11,y:6},{x:10,y:6},{x:9,y:6},{x:9,y:5},{x:8,y:5},{x:7,y:5},{x:6,y:5},{x:5,y:5},{x:4,y:5},{x:5,y:7},{x:6,y:7},{x:7,y:7},{x:6,y:9},{x:6,y:10}],[{x:5,y:4},{x:5,y:5},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:4,y:8},{x:4,y:9},{x:4,y:10},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:9,y:10},{x:9,y:9},{x:9,y:8},{x:9,y:7},{x:8,y:7},{x:8,y:6},{x:8,y:5},{x:8,y:4},{x:7,y:4},{x:6,y:4},{x:5,y:7},{x:5,y:8}],[{x:4,y:4},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:3,y:7},{x:3,y:8},{x:3,y:9},{x:3,y:10},{x:3,y:11},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:10,y:11},{x:10,y:10},{x:10,y:9},{x:10,y:8},{x:10,y:7},{x:9,y:7},{x:9,y:6},{x:9,y:5},{x:8,y:5},{x:7,y:5},{x:7,y:4},{x:6,y:4},{x:5,y:4},{x:5,y:7},{x:5,y:8},{x:7,y:7},{x:7,y:8},{x:8,y:9}],[{x:5,y:4},{x:5,y:5},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:4,y:8},{x:4,y:9},{x:3,y:9},{x:2,y:9},{x:2,y:10},{x:2,y:11},{x:3,y:11},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:10,y:11},{x:10,y:10},{x:10,y:9},{x:11,y:9},{x:11,y:8},{x:11,y:7},{x:11,y:6},{x:11,y:5},{x:11,y:4},{x:10,y:4},{x:9,y:4},{x:8,y:4},{x:7,y:4},{x:6,y:4},{x:8,y:5},{x:8,y:6},{x:8,y:8},{x:8,y:9},{x:7,y:8}]],r=d3.select("#canvas").append("svg").attr("width",c).attr("height",1e3),s=[];r.append("rect").attr("x",(c-o)/2).attr("y",l/2).attr("rx",10).attr("ry",10).attr("width",o).attr("height",n*e).attr("fill","#5d8679").attr("stroke-width",l).attr("stroke","#9c6017");for(var t=0;t<n;t++)for(var d=0;d<m;d++){var u=d*e+(c-o)/2,v=t*e+l/2;s.push({x:u,y:v,width:e,height:e,fill:"#486762",stroke:"white",posn:t+"_"+d,id:"s_"+t+"_"+d,class:"cell"})}r.selectAll("rect[class='cell']").data(s).enter().append("rect").attr("x",function(a){return a.x}).attr("rx",5).attr("ry",5).attr("y",function(a){return a.y}).attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).attr("fill",function(a){return a.fill}).attr("posn",function(a){return a.posn}).attr("stroke","#5d8679").attr("stroke-width",1).attr("id",function(a){return"s_"+a.posn}).attr("class","cell").attr("covered","no");var w=q[b-1];r.selectAll("rect[class='wall']").data(w).enter().append("rect").attr("x",function(a){return(a.x-1)*e+(c-o)/2}).attr("y",function(a){return(a.y-1)*e+l/2}).attr("rx",5).attr("ry",5).attr("width",e).attr("height",e).attr("fill","#b7b7bd").attr("posn",function(a){return a.y-1+"_"+(a.x-1)}).attr("stroke","#5d8679").attr("stroke-width",1).attr("id",function(a){return"w_"+(a.y-1)+"_"+(a.x-1)}).attr("class","wall").attr("covered","no");var x=[[{x:6,y:6},{x:8,y:8}],[{x:7,y:6},{x:8,y:6},{x:5,y:7},{x:5,y:9}],[{x:6,y:6},{x:8,y:6},{x:5,y:9}],[{x:6,y:6},{x:7,y:9},{x:8,y:9}],[{x:6,y:6},{x:6,y:7},{x:6,y:8},{x:6,y:9},{x:6,y:10}],[{x:9,y:7},{x:9,y:8},{x:9,y:9}],[{x:4,y:9},{x:5,y:9},{x:4,y:10},{x:5,y:10}],[{x:5,y:9},{x:5,y:10},{x:6,y:10},{x:7,y:10},{x:8,y:10}],[{x:4,y:8},{x:4,y:9},{x:4,y:10}],[{x:3,y:10},{x:4,y:10},{x:5,y:10},{x:6,y:10},{x:7,y:10}]][b-1];r.selectAll("circle[class='target']").data(x).enter().append("circle").attr("cx",function(a){return(a.x-1)*e+(c-o)/2+e/2}).attr("cy",function(a){return(a.y-1)*e+l/2+e/2}).attr("r",10).style("fill","#f05454").attr("id",function(a){return"t_"+(a.y-1)+"_"+(a.x-1)}).attr("class","target");var y=[[{x:6,y:7},{x:7,y:8}],[{x:6,y:7},{x:7,y:8},{x:6,y:9},{x:8,y:8}],[{x:6,y:7},{x:7,y:7},{x:8,y:7}],[{x:6,y:6},{x:6,y:7},{x:7,y:7}],[{x:6,y:6},{x:6,y:7},{x:6,y:8},{x:5,y:9},{x:7,y:9}],[{x:4,y:6},{x:4,y:7},{x:5,y:6}],[{x:4,y:7},{x:6,y:8},{x:9,y:8},{x:8,y:9}],[{x:6,y:6},{x:6,y:7},{x:6,y:9},{x:7,y:8},{x:7,y:10}],[{x:6,y:6},{x:5,y:9},{x:8,y:10}],[{x:5,y:7},{x:7,y:7},{x:9,y:7},{x:6,y:8},{x:6,y:9}]][b-1];r.selectAll("rect[class='box']").data(y).enter().append("rect").attr("x",function(a){return(a.x-1)*e+(c-o)/2+f}).attr("y",function(a){return(a.y-1)*e+l/2+f}).attr("rx",5).attr("ry",5).attr("width",e-2*f).attr("height",e-2*f).style("fill",g).attr("posn",function(a){return a.y-1+"_"+(a.x-1)}).attr("id",function(a){return"b_"+(a.y-1)+"_"+(a.x-1)}).attr("stroke-width",2).attr("stroke",h).attr("class","box");var z=[{x:7,y:7},{x:8,y:9},{x:6,y:8},{x:8,y:8},{x:8,y:7},{x:3,y:5},{x:4,y:8},{x:5,y:6},{x:5,y:6},{x:10,y:5}][b-1];r.append("rect").attr("x",(z.x-1)*e+(c-o)/2+f).attr("y",(z.y-1)*e+l/2+f).attr("rx",5).attr("ry",5).attr("width",e-2*f).attr("height",e-2*f).style("fill","#32acd1").attr("posn",z.y-1+"_"+(z.x-1)).attr("id","player").attr("stroke-width",2).attr("stroke","#0b6e8c");for(var A=function(a,b){d3.select("#b_"+a+"_"+b).attr("stroke","#185221").style("fill","#26bd3c")},B=function(a,b){d3.select("#b_"+a+"_"+b).attr("stroke",h).style("fill",g)},t=0;t<x.length;t++)1===d3.select("#b_"+(x[t].y-1)+"_"+(x[t].x-1)).size()&&A(x[t].y-1,x[t].x-1);var C=function(a){switch(a.which){case 37:break;case 38:break;case 39:break;case 40:break;default:return;}a.preventDefault()},D=function(a){switch(a.which){case 37:var b=d3.select("#player").attr("posn").split("_"),c=parseInt(b[0]),d=parseInt(b[1])-1;if(1===d3.select("#b_"+c+"_"+d).size()&&(1===d3.select("#w_"+c+"_"+(d-1)).size()||1===d3.select("#b_"+c+"_"+(d-1)).size())||1===d3.select("#w_"+c+"_"+d).size())break;F(c,d,"left");break;case 38:var b=d3.select("#player").attr("posn").split("_"),c=parseInt(b[0])-1,d=parseInt(b[1]);if(1===d3.select("#b_"+c+"_"+d).size()&&(1===d3.select("#w_"+(c-1)+"_"+d).size()||1===d3.select("#b_"+(c-1)+"_"+d).size())||1===d3.select("#w_"+c+"_"+d).size())break;F(c,d,"up");break;case 39:var b=d3.select("#player").attr("posn").split("_"),c=parseInt(b[0]),d=parseInt(b[1])+1;if(1===d3.select("#b_"+c+"_"+d).size()&&(1===d3.select("#w_"+c+"_"+(d+1)).size()||1===d3.select("#b_"+c+"_"+(d+1)).size())||1===d3.select("#w_"+c+"_"+d).size())break;F(c,d,"right");break;case 40:var b=d3.select("#player").attr("posn").split("_"),c=parseInt(b[0])+1,d=parseInt(b[1]);if(1===d3.select("#b_"+c+"_"+d).size()&&(1===d3.select("#w_"+(c+1)+"_"+d).size()||1===d3.select("#b_"+(c+1)+"_"+d).size())||1===d3.select("#w_"+c+"_"+d).size())break;F(c,d,"down");break;default:return;}a.preventDefault()},E=function(){for(var a=0;a<x.length;a++)if(0===d3.select("#b_"+(x[a].y-1)+"_"+(x[a].x-1)).size())return!1;return!0},F=function(a,b,d){if(d3.select("#player").transition().duration(k).on("start",function(){$(document).off("keydown"),$(document).keydown(C)}).attr("x",b*e+(c-o)/2+f).attr("y",a*e+l/2+f).attr("posn",a+"_"+b).on("end",function(){0===d3.select("#b_"+a+"_"+b).size()&&($(document).off("keydown"),$(document).keydown(D))}),1===d3.select("#b_"+a+"_"+b).size()){var g=a,h=b;"down"===d?g+=1:"up"===d?g-=1:"left"===d?h-=1:"right"===d?h+=1:void 0,d3.select("#b_"+a+"_"+b).transition().duration(k).attr("x",h*e+(c-o)/2+f).attr("y",g*e+l/2+f).attr("id","b_"+g+"_"+h).attr("posn",g+"_"+h).on("end",function(){$(document).off("keydown"),$(document).keydown(D),E()&&alert("Congrate, you have completed the game!")}),1===d3.select("#t_"+g+"_"+h).size()?A(a,b):B(a,b)}};$(document).keydown(D)});