$(function(){var t=65,s="black",r=d3.select("#canvas").append("svg").attr("width",570).attr("height",1e3);r.append("rect").attr("x",13).attr("y",13).attr("width",534).attr("height",534).attr("fill","white").attr("stroke-width",10).attr("stroke","black");for(var e=0;e<8;e++)for(var l=0;l<8;l++){var a=l*t+20,c=e*t+20;r.append("rect").attr("x",a).attr("y",c).attr("width",t).attr("height",t).attr("fill","#2aa133").attr("stroke-width",3).attr("stroke","black").attr("posn",e+"_"+l).attr("id",e+"_"+l).attr("class","cell"),r.append("circle").attr("cx",a+t/2).attr("cy",c+t/2).attr("r",22).attr("id","circle_"+e+"_"+l).attr("posn",e+"_"+l).style("fill","red").attr("opacity",0)}d3.select("#circle_3_3").attr("class","white").style("fill","white").attr("opacity",1),d3.select("#circle_3_4").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_3").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_4").attr("class","white").style("fill","white").attr("opacity",1),r.append("circle").attr("cx",150).attr("cy",150).attr("r",5),r.append("circle").attr("cx",410).attr("cy",150).attr("r",5),r.append("circle").attr("cx",150).attr("cy",410).attr("r",5),r.append("circle").attr("cx",410).attr("cy",410).attr("r",5);var i=60,b=600;r.append("rect").attr("x",80).attr("y",b).attr("rx",3).attr("ry",3).attr("width",i).attr("height",i).attr("fill","#2aa133").attr("stroke-width",4).attr("id","black_btn_boader").attr("stroke","gray"),r.append("circle").attr("cx",110).attr("cy",630).attr("r",20).attr("id","black_circle"),r.append("text").attr("x",180).attr("y",650).text("2").attr("id","black_num").style("font-size","64px");r.append("rect").attr("x",375).attr("y",600).attr("rx",3).attr("ry",3).attr("width",i).attr("height",i).attr("fill","#2aa133").attr("stroke-width",4).attr("id","white_btn_boader").attr("stroke","gray"),r.append("circle").attr("cx",405).attr("cy",630).attr("r",20).attr("id","white_circle").style("fill","white"),r.append("text").attr("x",475).attr("y",650).text("2").attr("id","white_num").style("font-size","64px");function f(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",8).attr("stroke",y),d3.select("rect[id='white_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),s="black"}function d(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='white_btn_boader']").attr("stroke-width",8).attr("stroke",y),s="white"}var y="#eb4034";d3.selectAll("#black_btn_boader, #black_circle").on("click",function(){f()}),d3.selectAll("#white_btn_boader, #white_circle").on("click",function(){d()}),d3.select("#black_circle").on("click")();function k(t,r,e){for(var l=[],a=t-1;0<=a;a--){var c=d3.select("#circle_"+a+"_"+r);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||0===a){l=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&l.push("#circle_"+a+"_"+r)}var i=[];for(a=t+1;a<8;a++){c=d3.select("#circle_"+a+"_"+r);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||7===a){i=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&i.push("#circle_"+a+"_"+r)}var s=[];for(a=r-1;0<=a;a--){c=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||0===a){s=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&s.push("#circle_"+t+"_"+a)}var b=[];for(a=r+1;a<8;a++){c=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||7===a){b=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&b.push("#circle_"+t+"_"+a)}for(var f=[],d=(a=t-1,r-1);0<=a&&0<=d;){c=d3.select("#circle_"+a+"_"+d);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||0===a||0===d){f=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&f.push("#circle_"+a+"_"+d),--a,--d}var y=[];for(a=t-1,d=r+1;0<=a&&d<8;){c=d3.select("#circle_"+a+"_"+d);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||0===a||7===d){y=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&y.push("#circle_"+a+"_"+d),--a,d+=1}var k=[];for(a=t+1,d=r-1;0<=d&&a<8;){c=d3.select("#circle_"+a+"_"+d);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||7===a||0===d){k=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&k.push("#circle_"+a+"_"+d),a+=1,--d}var _=[];for(a=t+1,d=r+1;a<8&&d<8;){c=d3.select("#circle_"+a+"_"+d);if("black"===e&&"rgb(0, 0, 0)"==c.style("fill")||"white"===e&&"rgb(255, 255, 255)"==c.style("fill"))break;if("0"===c.attr("opacity")||7===a||7===d){_=[];break}("black"===e&&"rgb(255, 255, 255)"==c.style("fill")||"white"===e&&"rgb(0, 0, 0)"==c.style("fill"))&&_.push("#circle_"+a+"_"+d),a+=1,d+=1}return[].concat(l,i,s,b,f,y,k,_)}function _(t){for(var r=0;r<8;r++)for(var e=0;e<8;e++){if("1"!==d3.select("#circle_"+r+"_"+e).attr("opacity"))if(0<k(r,e,t).length)return!0}return!1}d3.selectAll("rect[class='cell'], circle").on("click",function(){var t=d3.select(this).attr("posn");if("1"!==d3.select("#circle_"+t).attr("opacity")){var r=t.split("_"),e=parseInt(r[0]),l=parseInt(r[1]),a=k(e,l,s);if(0!==a.length){d3.select("#circle_"+t).style("fill",s).attr("opacity",1).attr("class",s),d3.selectAll(a.join(",")).style("fill",s).attr("class",s);var c=d3.selectAll("circle[class='black']").size(),i=d3.selectAll("circle[class='white']").size();d3.select("#black_num").text(c),d3.select("#white_num").text(i),i+c===64&&setTimeout(function(){var t="";t=c<i?"White Wins，白棋胜利！恭喜！🎉":i<c?"Black Wins，黑棋胜利！恭喜！🎉":"Tie Game，平局！",alert(t)},50),"black"===s?_("white")?d():_("black")&&(alert("白棋无处可走，棋权依然归黑色。"),f()):_("black")?f():_("white")&&(alert("黑棋无处可走，棋权依然归白色。"),d())}else"black"===s?alert("不可以走这里, 你需要至少翻掉一颗白棋"):alert("不可以走这里, 你需要至少翻掉一颗黑棋")}})});