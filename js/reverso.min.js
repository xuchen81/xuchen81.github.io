$(function(){var t=65,s="black",l=d3.select("#canvas").append("svg").attr("width",570).attr("height",1e3);l.append("rect").attr("x",13).attr("y",13).attr("width",534).attr("height",534).attr("fill","white").attr("stroke-width",10).attr("stroke","black");for(var e=0;e<8;e++)for(var r=0;r<8;r++){var a=r*t+20,i=e*t+20;l.append("rect").attr("x",a).attr("y",i).attr("width",t).attr("height",t).attr("fill","#2aa133").attr("stroke-width",3).attr("stroke","black").attr("posn",e+"_"+r).attr("id",e+"_"+r).attr("class","cell"),l.append("circle").attr("cx",a+t/2).attr("cy",i+t/2).attr("r",22).attr("id","circle_"+e+"_"+r).attr("posn",e+"_"+r).style("fill","red").attr("opacity",0)}d3.select("#circle_3_3").attr("class","white").style("fill","white").attr("opacity",1),d3.select("#circle_3_4").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_3").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_4").attr("class","white").style("fill","white").attr("opacity",1);var c=60,b=600;l.append("rect").attr("x",80).attr("y",b).attr("rx",3).attr("ry",3).attr("width",c).attr("height",c).attr("fill","#2aa133").attr("stroke-width",4).attr("id","black_btn_boader").attr("stroke","gray"),l.append("circle").attr("cx",110).attr("cy",630).attr("r",20).attr("id","black_circle"),l.append("text").attr("x",180).attr("y",650).text("2").attr("id","black_num").style("font-size","64px");l.append("rect").attr("x",375).attr("y",600).attr("rx",3).attr("ry",3).attr("width",c).attr("height",c).attr("fill","#2aa133").attr("stroke-width",4).attr("id","white_btn_boader").attr("stroke","gray"),l.append("circle").attr("cx",405).attr("cy",630).attr("r",20).attr("id","white_circle").style("fill","white"),l.append("text").attr("x",475).attr("y",650).text("2").attr("id","white_num").style("font-size","64px");function f(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",8).attr("stroke",_),d3.select("rect[id='white_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),s="black"}function k(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='white_btn_boader']").attr("stroke-width",8).attr("stroke",_),s="white"}var _="#eb4034";d3.selectAll("#black_btn_boader, #black_circle").on("click",function(){f()}),d3.selectAll("#white_btn_boader, #white_circle").on("click",function(){k()}),d3.select("#black_circle").on("click")();function d(t,l,e){for(var r=[],a=t-1;0<=a;a--){var i=d3.select("#circle_"+a+"_"+l);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||0===a){r=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&r.push("#circle_"+a+"_"+l)}var c=[];for(a=t+1;a<8;a++){i=d3.select("#circle_"+a+"_"+l);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||7===a){c=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&c.push("#circle_"+a+"_"+l)}var s=[];for(a=l-1;0<=a;a--){i=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||0===a){s=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&s.push("#circle_"+t+"_"+a)}var b=[];for(a=l+1;a<8;a++){i=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||7===a){b=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&b.push("#circle_"+t+"_"+a)}for(var f=[],k=(a=t-1,l-1);0<=a&&0<=k;){i=d3.select("#circle_"+a+"_"+k);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||0===a||0===k){f=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&f.push("#circle_"+a+"_"+k),--a,--k}var _=[];for(a=t-1,k=l+1;0<=a&&k<8;){i=d3.select("#circle_"+a+"_"+k);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||0===a||7===k){_=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&_.push("#circle_"+a+"_"+k),--a,k+=1}var d=[];for(a=t+1,k=l-1;0<=k&&a<8;){i=d3.select("#circle_"+a+"_"+k);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||7===a||0===k){d=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&d.push("#circle_"+a+"_"+k),a+=1,--k}var o=[];for(a=t+1,k=l+1;a<8&&k<8;){i=d3.select("#circle_"+a+"_"+k);if("black"===e&&"rgb(0, 0, 0)"==i.style("fill")||"white"===e&&"rgb(255, 255, 255)"==i.style("fill"))break;if("0"===i.attr("opacity")||7===a||7===k){o=[];break}("black"===e&&"rgb(255, 255, 255)"==i.style("fill")||"white"===e&&"rgb(0, 0, 0)"==i.style("fill"))&&o.push("#circle_"+a+"_"+k),a+=1,k+=1}return[].concat(r,c,s,b,f,_,d,o)}function o(t){for(var l=0;l<8;l++)for(var e=0;e<8&&"1"!==d3.select("#circle_"+l+"_"+e).attr("opacity");e++){if(0<d(l,e,t).length)return!0}return!1}d3.selectAll("rect[class='cell'], circle").on("click",function(){var t=d3.select(this).attr("posn");if("1"!==d3.select("#circle_"+t).attr("opacity")){var l=t.split("_"),e=parseInt(l[0]),r=parseInt(l[1]),a=d(e,r,s);if(0!==a.length){d3.select("#circle_"+t).style("fill",s).attr("opacity",1).attr("class",s),d3.selectAll(a.join(",")).style("fill",s).attr("class",s);var i=d3.selectAll("circle[class='black']").size(),c=d3.selectAll("circle[class='white']").size();d3.select("#black_num").text(i),d3.select("#white_num").text(c),c+i===64&&setTimeout(function(){var t="";t=i<c?"White Wins，白棋胜利！恭喜！🎉":c<i?"Black Wins，黑棋胜利！恭喜！🎉":"Tie Game，平局！",alert(t)},50),"black"===s?o("white")?k():o("black")&&(alert("白棋无处可走，棋权依然归黑色。"),f()):o("black")?f():o("white")&&(alert("黑棋无处可走，棋权依然归白色。"),k())}else"black"===s?alert("不可以走这里, 你需要至少翻掉至少一颗白棋"):alert("不可以走这里, 你需要至少翻掉至少一颗黑棋")}})});