$(function(){var t="black",r=d3.select("#canvas").append("svg").attr("width",570).attr("height",1e3);r.append("rect").attr("x",13).attr("y",13).attr("width",534).attr("height",534).attr("fill","white").attr("stroke-width",10).attr("stroke","black");for(var e=0;e<8;e++)for(var l=0;l<8;l++){var a=65*l+20,c=65*e+20;r.append("rect").attr("x",a).attr("y",c).attr("width",65).attr("height",65).attr("fill","#2aa133").attr("stroke-width",3).attr("stroke","black").attr("posn",e+"_"+l).attr("id",e+"_"+l).attr("class","cell"),r.append("circle").attr("cx",a+32.5).attr("cy",c+32.5).attr("r",22).attr("id","circle_"+e+"_"+l).attr("posn",e+"_"+l).style("fill","red").attr("opacity",0)}d3.select("#circle_3_3").attr("class","white").style("fill","white").attr("opacity",1),d3.select("#circle_3_4").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_3").attr("class","black").style("fill","black").attr("opacity",1),d3.select("#circle_4_4").attr("class","white").style("fill","white").attr("opacity",1),r.append("circle").attr("cx",150).attr("cy",150).attr("r",5),r.append("circle").attr("cx",410).attr("cy",150).attr("r",5),r.append("circle").attr("cx",150).attr("cy",410).attr("r",5),r.append("circle").attr("cx",410).attr("cy",410).attr("r",5);r.append("rect").attr("x",80).attr("y",600).attr("rx",3).attr("ry",3).attr("width",60).attr("height",60).attr("fill","#2aa133").attr("stroke-width",4).attr("id","black_btn_boader").attr("stroke","gray"),r.append("circle").attr("cx",110).attr("cy",630).attr("r",20).attr("id","black_circle"),r.append("text").attr("x",180).attr("y",650).text("2").attr("id","black_num").style("font-size","64px");r.append("rect").attr("x",375).attr("y",600).attr("rx",3).attr("ry",3).attr("width",60).attr("height",60).attr("fill","#2aa133").attr("stroke-width",4).attr("id","white_btn_boader").attr("stroke","gray"),r.append("circle").attr("cx",405).attr("cy",630).attr("r",20).attr("id","white_circle").style("fill","white"),r.append("text").attr("x",475).attr("y",650).text("2").attr("id","white_num").style("font-size","64px");var i=function(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",8).attr("stroke","#eb4034"),d3.select("rect[id='white_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),t="black"},s=function(){d3.select("rect[id='black_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='white_btn_boader']").attr("stroke-width",8).attr("stroke","#eb4034"),t="white"};d3.selectAll("#black_btn_boader, #black_circle").on("click",function(){i()}),d3.selectAll("#white_btn_boader, #white_circle").on("click",function(){s()}),d3.select("#black_circle").on("click")();var b=function(t,r,e){for(var l=[],a=t-1;a>=0;a--){_=d3.select("#circle_"+a+"_"+r);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||0===a){l=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&l.push("#circle_"+a+"_"+r)}for(var c=[],a=t+1;a<8;a++){_=d3.select("#circle_"+a+"_"+r);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||7===a){c=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&c.push("#circle_"+a+"_"+r)}for(var i=[],a=r-1;a>=0;a--){_=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||0===a){i=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&i.push("#circle_"+t+"_"+a)}for(var s=[],a=r+1;a<8;a++){_=d3.select("#circle_"+t+"_"+a);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||7===a){s=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&s.push("#circle_"+t+"_"+a)}for(var b=[],a=t-1,f=r-1;a>=0&&f>=0;){_=d3.select("#circle_"+a+"_"+f);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||0===a||0===f){b=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&b.push("#circle_"+a+"_"+f),a-=1,f-=1}var d=[];for(a=t-1,f=r+1;a>=0&&f<8;){_=d3.select("#circle_"+a+"_"+f);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||0===a||7===f){d=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&d.push("#circle_"+a+"_"+f),a-=1,f+=1}var y=[];for(a=t+1,f=r-1;f>=0&&a<8;){_=d3.select("#circle_"+a+"_"+f);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||7===a||0===f){y=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&y.push("#circle_"+a+"_"+f),a+=1,f-=1}var k=[];for(a=t+1,f=r+1;a<8&&f<8;){var _=d3.select("#circle_"+a+"_"+f);if("black"===e&&"rgb(0, 0, 0)"==_.style("fill")||"white"===e&&"rgb(255, 255, 255)"==_.style("fill"))break;if("0"===_.attr("opacity")||7===a||7===f){k=[];break}("black"===e&&"rgb(255, 255, 255)"==_.style("fill")||"white"===e&&"rgb(0, 0, 0)"==_.style("fill"))&&k.push("#circle_"+a+"_"+f),a+=1,f+=1}return[].concat(l,c,i,s,b,d,y,k)},f=function(t){for(var r=0;r<8;r++)for(var e=0;e<8&&"1"!==d3.select("#circle_"+r+"_"+e).attr("opacity");e++)if(b(r,e,t).length>0)return!0;return!1};d3.selectAll("rect[class='cell'], circle").on("click",function(){var r=d3.select(this).attr("posn");if("1"!==d3.select("#circle_"+r).attr("opacity")){var e=r.split("_"),l=parseInt(e[0]),a=parseInt(e[1]),c=b(l,a,t);if(0!==c.length){d3.select("#circle_"+r).style("fill",t).attr("opacity",1).attr("class",t),d3.selectAll(c.join(",")).style("fill",t).attr("class",t);var d=d3.selectAll("circle[class='black']").size(),y=d3.selectAll("circle[class='white']").size();d3.select("#black_num").text(d),d3.select("#white_num").text(y),y+d===64&&setTimeout(function(){var t="";t=y>d?"White Wins，白棋胜利！恭喜！🎉":y<d?"Black Wins，黑棋胜利！恭喜！🎉":"Tie Game，平局！",alert(t)},50),"black"===t?f("white")?s():f("black")&&(alert("白棋无处可走，棋权依然归黑色。"),i()):f("black")?i():f("white")&&(alert("黑棋无处可走，棋权依然归白色。"),s())}else"black"===t?alert("不可以走这里, 你需要翻掉至少一颗白棋"):alert("不可以走这里, 你需要翻掉至少一颗黑棋")}})});