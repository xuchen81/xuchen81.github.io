$(function(){function l(t){for(var e=[],r=1;r<=t*t;r++)e.push(r);for(var a=[];0!=e.length;){var s=Math.floor(Math.random()*e.length);a.push(e[s]),e.splice(s,1)}return a}var t=new URLSearchParams(window.location.search).get("s")||4,d=parseInt(t),_=750,u="#361d00",e=d3.select("#canvas").append("svg").attr("width",1e3).attr("height",1e3),r=function(t){for(var e,r,a,s,n=l(t);r=t,void 0,a=function(t){for(var e=0,r=0;r<t.length;r++)for(var a=r+1;a<t.length;a++)t[r]>t[a]&&(e+=1);return e}(e=n),s=e.indexOf(e.length),(a+(r-(Math.floor(s/r)+1)+(r-(1+s%r))))%2!=0;)n=l(t);return n}(d);e.append("rect").attr("x",25).attr("y",5).attr("rx",10).attr("ry",10).attr("width",_).attr("height",_).attr("fill","#9c6017").attr("stroke-width",10).attr("stroke","#9c6017");for(var a=0,s=0;s<d;s++)for(var n=0;n<d;n++){var c=n*_/d+125-100,i=s*_/d+5;if(e.append("rect").attr("x",c).attr("y",i).attr("rx",10).attr("ry",10).attr("width",_/d).attr("height",_/d).attr("fill","#ffb963").attr("stroke-width",3).attr("stroke","#9c6017").attr("posn",s+"_"+n).attr("id","r_"+s+"_"+n).attr("class","cell"),r[a]!==d*d){e.append("text").attr("x",c).attr("y",i).text(r[a]).attr("id","t_"+s+"_"+n).attr("posn",s+"_"+n).attr("class","cell_num").style("fill","#734103").style("font-size","84px");var o=d3.select("#t_"+s+"_"+n).node().getBoundingClientRect().width,p=d3.select("#t_"+s+"_"+n).node().getBoundingClientRect().height;d3.select("#t_"+s+"_"+n).attr("x",c+_/d/2-o/2).attr("y",i+_/d/2+p/2-20),a+=1}else d3.select("#r_"+s+"_"+n).style("fill",u).attr("class","empty"),a+=1}e.append("rect").attr("x",850).attr("y",325).attr("rx",10).attr("ry",10).attr("width",100).attr("height",100).attr("fill","#d99055").attr("stroke-width",3).attr("stroke","#9c6017").attr("id","step_box"),e.append("text").attr("x",850).attr("y",325).text(0).attr("id","step_counter").style("fill","white").style("font-size","44px");o=d3.select("#step_counter").node().getBoundingClientRect().width,p=d3.select("#step_counter").node().getBoundingClientRect().height;d3.select("#step_counter").attr("x",900-o/2).attr("y",375+p/2-10),e.append("text").text("步数").attr("x",868).attr("y",305).style("fill","#6e523b").style("font-size","30px");function f(t,e){var r=d3.select(".empty").attr("posn"),a=parseInt(r.split("_")[0]),s=parseInt(r.split("_")[1]),n=parseInt(d3.select(".empty").attr("x")),l=parseInt(d3.select(".empty").attr("y")),c=parseInt(d3.select("#r_"+t+"_"+e).attr("x")),i=parseInt(d3.select("#r_"+t+"_"+e).attr("y"));d3.select("#r_"+t+"_"+e).attr("x",n).attr("y",l).attr("id","r_"+a+"_"+s).attr("posn",a+"_"+s),d3.select("#t_"+t+"_"+e).attr("x",n).attr("y",l).attr("id","t_"+a+"_"+s).attr("posn",a+"_"+s);var o=d3.select("#t_"+a+"_"+s).node().getBoundingClientRect().width,p=d3.select("#t_"+a+"_"+s).node().getBoundingClientRect().height;d3.select("#t_"+a+"_"+s).attr("x",n+_/d/2-o/2).attr("y",l+_/d/2+p/2-20),d3.select(".empty").style("fill",u).attr("x",c).attr("y",i).attr("id","r_"+t+"_"+e).attr("posn",t+"_"+e).style("fill",u),function(){var t=parseInt(d3.select("#step_counter").text());d3.select("#step_counter").text(t+1);var e=d3.select("#step_counter").node().getBoundingClientRect().width;d3.select("#step_counter").attr("x",900-e/2)}()}function h(){var t=d-1;if(d3.select(".empty").attr("posn")!==t+"_"+t)return!1;for(var e=0;e<d;e++)for(var r=0;r<d&&(e!==d-1||r!==d-1);r++){if(parseInt(d3.select("#t_"+e+"_"+r).text())!==e*d+r+1)return!1}return!0}d3.selectAll("rect[class='cell'], text[class='cell_num']").on("click",function(){var t=d3.select(this).attr("posn"),e=parseInt(t.split("_")[0]),r=parseInt(t.split("_")[1]);0<=e-1&&d3.select(".empty").attr("posn")===e-1+"_"+r?f(e,r):e+1<d&&d3.select(".empty").attr("posn")===e+1+"_"+r?f(e,r):0<=r-1&&d3.select(".empty").attr("posn")===e+"_"+(r-1)?f(e,r):r+1<d&&d3.select(".empty").attr("posn")===e+"_"+(r+1)&&f(e,r),h()&&setTimeout(function(){alert("你成功的还原了拼图，恭喜！🎉")},100)}),$(document).keydown(function(t){switch(t.which){case 37:var e=d3.select(".empty").attr("posn").split("_"),r=parseInt(e[0]);(a=parseInt(e[1])+1)<d&&(f(r,a),h()&&setTimeout(function(){alert("你成功的还原了拼图，恭喜！🎉")},100));break;case 38:e=d3.select(".empty").attr("posn").split("_"),r=parseInt(e[0])+1;var a=parseInt(e[1]);r<d&&(f(r,a),h()&&setTimeout(function(){alert("你成功的还原了拼图，恭喜！🎉")},100));break;case 39:e=d3.select(".empty").attr("posn").split("_"),r=parseInt(e[0]);0<=(a=parseInt(e[1])-1)&&(f(r,a),h()&&setTimeout(function(){alert("你成功的还原了拼图，恭喜！🎉")},100));break;case 40:e=d3.select(".empty").attr("posn").split("_"),r=parseInt(e[0])-1,a=parseInt(e[1]);0<=r&&(f(r,a),h()&&setTimeout(function(){alert("你成功的还原了拼图，恭喜！🎉")},100));break;default:return}t.preventDefault()})});